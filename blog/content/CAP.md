---
title: CAP
aliases:
  - CAP 정리
description: 
permalink: 
classification: 
tags:
  - cap
draft: false
date: 2025-08-17
created: 2024-09-19T17:45
updated: 2025-08-17T23:02
---

![|1000](https://i.imgur.com/DUPwwXi.png)

분산 시스템은 원하는 세 가지 특성, 일관성, 가용성, 분항 내성 중 두 가지만 제공할 수 있음을 증명한 정리

일관성(Consistency)
- 어떤 노드에 연결되었는지와 무관하게 모든 클라이언트가 동시에 동일 데이터를 볼 수 있음을 의미한다.
- 데이터가 하나의 노드에 기록될 때마다 이 데이터는 쓰기가 '성공'으로 간주되기 전에 시스템의 다른 모든 노드로 즉시 전달되거나 복제되어야 한다.
가용성(Availability)
- 하나 이상의 노드가 작동 중지된 경우에도 데이터를 요청하는 클라이언트가 응답을 받음을 의미한다.
- 분산 시스템의 모든 작업 중인 노드는 예외 없이 모든 요청에 대해 유효한 응답을 리턴한다.
분할 내성(Partition tolerance)
- 분할(Partition)이란 분산 시스템 내의 네트워크 단절, 즉 두 노드 간의 연결이 유실되거나 일시적으로 지연된 상태를 말한다.
- 분할 내성(Partition Tolerance)이란 시스템의 노드 간에 다수의 네트워크 단절에도 불구하고 클러스터가 계속해서 작동함을 의미한다.

### CAP 와 NoSQL

NoSQL DB는 분산 네트워크 어플리케이션에 적합하다.
수직 확장이 가능한 RDB와 달리 NoSQL DB 에서는 수평 확장이 가능하고 설계에 따라 분산된다.
즉, 여러 개의 상호 연결된 노드로 구성된 성장 네트워크에서 빠르게 확장할 수 있다.

NoSQL DB는 CAP 중 두 개의 특성을 기반으로 분류된다.
CP 데이터 베이스
- 가용성을 희생시키면서 일관성과 분할 내성을 제공
- 두 노드 간에 분할이 발생하면, 시스템은 분할이 해결될 때까지 일관되지 않은 노드를 종료(즉, 사용 불가능하게)해야 한다.
AP 데이터 베이스
- AP 데이터베이스는 일관성을 희생시키면서 가용성과 분할 내성을 제공
- 분할이 발생했을 때 모든 노드가 사용 가능한 상태로 유지되지만 잘못된 분할에 놓인 노드는 다른 노드보다 오래된 버전의 데이터를 리턴할 수 있다.
- 분할이 해결되면 AP 데이터베이스는 일반적으로 노드를 재동기화하여 시스템의 모든 불일치를 복구한다.
CA 데이터베이스
- 모든 노드에서 일관성과 가용성을 제공합니다.
- 시스템에 있는 두 노드 사이에 분할이 있으면 일관성과 가용성을 제공할 수 없기 때문에 내결함성을 제공할 수 없다.
- 분산 시스템에서는 분할을 피할 수 없으므로 CA 데이터베이스는 존재할 수 없다.

### CAP 와 MongoDB

- MongoDB는 CP 데이터 저장소이며 가용성을 희생시키면서 일관성을 유지하여 네트워크 분할을 해결한다.
- MongoDB는 단일 마스터 시스템으로, 각 복제본 세트에는 모든 쓰기 조작을 수신하는 하나의 기본 노드만 있을 수 있다.
- 동일한 복제본 세트의 다른 모든 노드는 1차 노드의 조작 로그를 복제하여 자체 데이터 세트에 적용하는 2차 노드이다.
- 기본적으로 클라이언트는 1차 노드에서 읽지만, 이는 2차 노드에서도 읽을 수 있도록 허용하는 읽기 환경 설정을 지정할 수도 있다.
- 1차 노드가 사용 불가능하게 되면, 가장 최근의 조작 로그가 있는 2차 노드가 새 1차 노드로 선정된다.
- 다른 모든 2차 노드가 새 마스터를 따라잡으면 클러스터를 다시 사용할 수 있게 된다.
- 클라이언트가 이 간격 동안 쓰기 요청을 할 수 없으므로, 데이터는 전체 네트워크에서 일관성을 유지합니다.

### CAP 와 마이크로 서비스

- CAP 정리를 이해하면 여러 위치에서 실행 중인 마이크로 서비스 기반 애플리케이션을 설계할 때 최상의 데이터베이스를 선택하는 데 도움이 된다.
	- 애플리케이션에 데이터 모델을 빠르게 반복하고 수평으로 확장하는 기능이 필수이지만, 궁극적 일관성을 허용할 수 있는 경우 Cassandra 또는 Apache CouchDB와 같은 AP 데이터베이스는 사용자 요구사항을 충족시키고 배치를 간소화할 수 있다.
	- 반대로, 애플리케이션이 eCommerce 애플리케이션이나 지불 서비스에서와 같이 데이터 일관성에 크게 의존하는 경우에는 PostgreSQL 등의 관계형 데이터베이스를 선택할 수 있다.

### Links

[IBM - CAP](https://www.ibm.com/kr-ko/topics/cap-theorem)
[A Beginner’s Guide to CAP Theorem for Data Engineering](https://www.analyticsvidhya.com/blog/2020/08/a-beginners-guide-to-cap-theorem-for-data-engineering/)
